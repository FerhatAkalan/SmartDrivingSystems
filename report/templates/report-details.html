{% extends 'layout.html' %}
{% block content %}
{% load static %}
<div class="container">
    <h1 class="my-4">Report Details</h1>
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Report ID: {{ report.id }}</h5>
            <p class="card-text">Report Text: {{ report.report_text }}</p>
            <p class="card-text">Created At: {{ report.created_at }}</p>
            <hr>
            <h5 class="card-title">Driver Information</h5>
            <p class="card-text">Driver: {{ report.driver.driver_name }} {{ report.driver.driver_surname }}</p>
            <p class="card-text">Driver Licence: {{ report.driver.driver_licence }}</p>
            <hr>
            <h5 class="card-title">Trip Information</h5>
            <p class="card-text">Trip Start Time: {{ report.trip.start_time }}</p>
            <p class="card-text">Trip End Time: {{ report.trip.end_time }}</p>
            <hr>
            <p class="card-text">Video Path: {{ report.report_path }}</p>
            {% if report_details %}
            <p class="card-text">Safe Driving Score: {{ report_details.confidence }}</p>
            <div class="card-body">
                {% if report.report_path|slice:'-4:' == '.jpg' %}
                    <img src="{% static report.report_path %}" alt="Detected Image" class="img-fluid">
                {% elif report.report_path|slice:'-4:' == '.mp4' %}
                    <video width="100%" height="auto" controls>
                        <source src="{% static report.report_path %}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                {% endif %}
            </div>
            {% endif %}
            <!-- Diğer rapor detayları buraya eklenebilir -->
            <hr>
            <h5 class="card-title">Report Details </h5>
                    <div class="card-body" id="result-details">
                        {% for item in report_details %}
                            {% if item.label != "Unknown" %}
                                <div class="card-body" style="display: none;">
                                    <ul class="list-group">
                                        <li class="list-group-item">
                                            {% comment %} <strong>Detected Boxes:  {{ item.frame_info  }}</strong><br> {% endcomment %}
                                            Class: {{ item.label }}<br>
                                            Confidence: {{ item.confidence }}<br>
                                            Sol Üst Köşe (x_min, y_min): ({{ item.top_left_x }}, {{ item.top_left_y }})<br>
                                            Sağ Alt Köşe (x_max, y_max): ({{ item.bottom_right_x }}, {{ item.bottom_right_y }})<br>
                                            Merkez Koordinatlar (x_center, y_center): ({{ item.center_x }}, {{ item.center_y }})<br>
                                            Genişlik: {{ item.width }}<br>
                                            Yükseklik: {{ item.height }}<br>
                                            Masks: {{ item.masks }}<br>
                                            Keypoints: {{ item.keypoints }}<br>
                                            Probabilities: {{ item.probabilities }}<br>
                                            {% comment %} <li class="list-group-item">
                                                <strong>Frame Info:</strong><br>
                                                {{ item.frame_info  }}
                                            </li> {% endcomment %}
                                        </li>
                                    </ul>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <div class="card-footer d-flex justify-content-between align-items-center">
                        <div>
                        </div>
                        <div class="d-flex align-items-center">
                            <div class="btn-group" role="group" aria-label="Page Navigation">
                                <button id="prev-page" class="btn btn-secondary">Previous</button>
                                <button id="next-page" class="btn btn-secondary">Next</button>
                                <p id="page-info" class="mb-0 mx-3"></p>
                            </div>
                        </div>
                    </div>
            <script>
                // Sayfalama işlemi için gerekli değişkenler
                var currentPage = 1;
                var itemsPerPage = 1; // Sayfa başına gösterilecek öğe sayısı
                // Sayfa yüklendiğinde ilk sayfayı göster
                showPage(currentPage);
                // Sayfalama işlemini gerçekleştiren fonksiyon
                function showPage(page) {
                    var elements = document.querySelectorAll('#result-details .card-body'); // Sonuçları içeren kartların listesi
                    // Tüm kartları gizle
                    elements.forEach(function(element) {
                        element.style.display = 'none';
                    });
                    // Belirtilen aralıktaki kartları göster
                    elements[page - 1].style.display = 'block';
                    // Sayfa bilgisini güncelle
                    var totalItems = elements.length;
                    var totalPages = Math.ceil(totalItems / itemsPerPage);
                    document.getElementById('page-info').textContent = 'Page ' + page + '/' + totalPages;
                }
                // Sayfa değiştirme düğmelerine tıklama olayını dinle
                document.getElementById('prev-page').addEventListener('click', function() {
                    if (currentPage > 1) {
                        currentPage--;
                        showPage(currentPage);
                    }
                });
                document.getElementById('next-page').addEventListener('click', function() {
                    var totalItems = document.querySelectorAll('#result-details .card-body').length;
                    var totalPages = Math.ceil(totalItems / itemsPerPage);
                    if (currentPage < totalPages) {
                        currentPage++;
                        showPage(currentPage);
                    }
                });
            </script>
            <div>
                <a href="{% url 'driver_reports' %}" class="btn btn-secondary">Back to Reports</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

